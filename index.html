<!DOCTYPE html>
<html lang="ha">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Earnify Telegram Mine ğŸ’°</title>
  <style>
    body {
      text-align:center;
      background:#eef6ff;
      font-family:'Poppins',sans-serif;
      color:#222;
    }
    .box {
      margin:50px auto;
      padding:25px;
      width:330px;
      background:white;
      border-radius:20px;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
    }
    img {
      border-radius:50%;
      width:80px;
      height:80px;
      margin-top:10px;
    }
    button {
      background:#0088cc;
      color:white;
      padding:12px 25px;
      border:none;
      border-radius:12px;
      margin-top:15px;
      font-size:16px;
      cursor:pointer;
    }
    button:active {
      background:#006fa8;
    }
    h2 {color:#0077b6;}
    #msg {color:#009900;font-weight:bold;}
  </style>
</head>
<body>
  <div class="box">
    <h2>Earnify Spin App ğŸ’°</h2>
    <p id="loading">ğŸ”„ Ana karÉ“ar bayanan Telegram...</p>
    <div id="user" style="display:none;">
      <img id="photo" alt="">
      <h3 id="name"></h3>
      <p>Balance: <span id="coins">0</span> ğŸª™</p>
      <button onclick="spin()">ğŸ¯ Spin</button>
      <p id="msg"></p>
    </div>
  </div>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Firebase App + Firestore -->
  <script type="module">
    // ğŸ”¥ Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    // ğŸ”§ Saka config É—inka daga Firebase console
    const firebaseConfig = {
      apiKey: "AIzaSyCHcq26RsESFvybcPjg2JQ6Kggk1SeB39Y",
      authDomain: "telegram-93975.firebaseapp.com",
      projectId: "telegram-93975",
      storageBucket: "telegram-93975.firebasestorage.app",
      messagingSenderId: "1010451855775",
      appId: "1:1010451855775:web:239e17f3626ae8a336a5aa"
    };

    // âš™ï¸ Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ğŸ¤– Telegram WebApp init
    const tg = window.Telegram.WebApp;
    tg.expand();

    const user = tg.initDataUnsafe?.user;

    if (user) {
      document.getElementById("loading").style.display = "none";
      document.getElementById("user").style.display = "block";
      document.getElementById("name").textContent = user.first_name;
      if(user.photo_url) document.getElementById("photo").src = user.photo_url;
      saveUser(user);
    } else {
      document.getElementById("loading").textContent = "âŒ Ba a samu bayanan Telegram ba";
    }

    // ğŸ’¾ Ajiye user a Firestore
    async function saveUser(user){
      const uid = "tg_" + user.id;
      const ref = doc(db, "users", uid);
      const snap = await getDoc(ref);
      if(!snap.exists()){
        await setDoc(ref, {
          name:user.first_name,
          username:user.username || "",
          balance:0,
          joined: new Date().toISOString()
        });
      }
      const data = (await getDoc(ref)).data();
      document.getElementById("coins").textContent = data.balance;
      window.USERID = uid;
    }

    // ğŸ¯ Spin button
    async function spin(){
      const reward = Math.floor(Math.random()*80)+10; // Random 10â€“90
      const ref = doc(db, "users", window.USERID);
      await updateDoc(ref, {balance: increment(reward)});
      const data = (await getDoc(ref)).data();
      document.getElementById("coins").textContent = data.balance;
      document.getElementById("msg").textContent = "âœ… Ka ci ğŸª™ " + reward + " coins!";
    }
  </script>
</body>
</html>